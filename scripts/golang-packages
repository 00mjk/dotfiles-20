#!/usr/bin/env zsh

function go_install() {
  echo "--- ${1} ---"

  if go_gte_1_16; then
    go install "${1}@latest"
  else
    go get -u "${1}"
  fi
}

function go_gte_1_16() {
  # extract the numeric portion of the go version by discarding head and tail,
  # and remove "go" before the numbers
  # alternatively:
  #
  #   go version | grep --colour=never --extended-regexp --only-matching '([[:digit:]]|\.)+[[:space:]]'
  #
  local go_version=$(go version | { read _ _ v _; echo ${v#go}; })

  [ "${go_version}" = $(echo -e "${go_version}\n1.16" | sort -Vr | head -n1) ]
}

pushd ~
go_install 'mvdan.cc/gofumpt'
go_install 'honnef.co/go/tools/cmd/staticcheck'
go_install 'github.com/kyoh86/richgo'
go_install 'github.com/mgechev/revive'
go_install 'github.com/cespare/reflex'
go_install 'github.com/dundee/gdu/v5/cmd/gdu'
# go_install 'github.com/asciimoo/wuzz'
# go_install 'golang.org/x/exp/cmd/modgraphviz'
# go_install 'github.com/jfeliu007/goplantuml/cmd/goplantuml'
# go_install 'github.com/KyleBanks/depth/cmd/depth'
popd

echo "[setup] Update Go binaries for Vim"
vim +GoUpdateBinaries +qall
